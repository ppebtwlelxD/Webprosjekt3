<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />

    <!-- Below we added font awesome icons to make it look better. -->
    <script src="https://kit.fontawesome.com/7bb013fa3f.js" crossorigin="anonymous"></script>

    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <body>
    
      <!-- LOGINDIV -->

    <div id="root"></div>

     <ul  id="nav-mobile" class="ulnav hide-on-med-and-down">
      <li class="list"><a onclick="homeshow()" class="active lista" href="#Home">Home</a></li>
      <li class="list"><a onclick="communityshow()" class="lista" href="#Community">Community</a></li>
      <li class="list"><a onclick="markdeshop()" class="lista" href="#Market">Market</a></li>
      <li class="list"><a onclick="abuteshow()" class="lista" href="#Abute">Abute</a></li>

      <li class="logged-in list" style="display: none; float:right;"><a href="#" class="lista  modal-trigger"  id="logout">Logout</a></li>
      <li class="logged-in list" style="display: none; float:right;" ><a href="#" class="lista  modal-trigger" data-target="modal-account">Profil</a></li>
      <li class="logged-out list" style="display: none; float:right;"><a href="#" class="lista  modal-trigger"  data-target="modal-login">Login</a></li>
      <li class="logged-out list" style="display: none; float:right;"><a href="#" class="lista  modal-trigger"  data-target="modal-signup">Sign up</a></li>
  </ul>

    <div Id="abute" style="display: none;">
      <div>
        <div>
            <h3>Page Owner</h3>
            <p>Contact: Pavan Sriram</p>
            <p>Email: pavan.sriram@digitalnorway.com</p>
            <p>Mobile: 41067657</p>
        </div>
    </div>
    </div>

  <div Id="home" style="display: block;">
    <div>
          <p>
          <h3>Page Discription</h3>
          <p>This page is the onestop shop for global mobility and collaboration activities within Education, Research and Innovation.
              The users of this page are  be the students, parents (of high school students),
              teachers/researchers/instructors and institutions through one digital platform.</p>


          </p>
      </div>
 </div>


    <div Id="marked" style="display: none;">

    <div class="marked">
      <h2>Marked</h2>
      <p>
        Here you can sell the thing u dont need anymore to 
        other students in the area. This may be usefull if 
        you are done with your studies or if u just started 
        out to get some of the thing you need.
      </p>
    
      <div class="logged-in" style="display: none;">
            Price <input type="text" id="pbox">
            Description <input type="text" id="dbox">
            Title <input type="text" id="title">
            <style> img { height: 100px; width: 100px;} </style>
            <img id="myimg"><label id="upProgress"></label>

            <button id='upload'>Upload</button>
            <button id='select'>Select</button>
        </div>

        <div class="container">
          <div class="row" id="posts-collection">
            <hr />
          </div>
        
        </div>

    </div>
  </div>


        <style>
      .ulnav {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #333;
    }
    
    .list {
      float: left;
      border-right:1px solid #bbb;
    }
    
    .list:last-child {
      border-right: none;
    }
    
    .lista {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }
    
    .lista:hover:not(.active) {
      background-color: #111;
    }
    
        .button {
          border: none;
          color: white;
          padding: 15px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin: 0px 2px 0px 93%;
          cursor: pointer;
          background-color: #343A40;

          
        }
        .loginul {
          background-color: #343A40;
          display: inline;
          padding: 0px 0px 0px 0px;
        }
        </style>
      <!-- SIGN UP MODAL -->
      <div id="modal-signup" class="modal">
        <div class="modal-content">
          <h4>Sign up</h4><br />
          <form id="signup-form">
            <div class="input-field">
              <input type="email" id="signup-email" required />
              <label for="signup-email">Email address</label>
            </div>
            <div class="input-field">
              <input type="password" id="signup-password" required />
              <label for="signup-password">Choose password</label>
            </div>
            <div class="input-field">
              <input type="text" id="signup-bio" required />
              <label for="signup-bio">One Line Bio</label>
            </div>
            <button class="btn yellow darken-2 z-depth-0">Sign up</button>
            <p class="error pink-text center-align"></p>
          </form>
        </div>
      </div>
    
      <!-- LOGIN MODAL -->
      <div id="modal-login" class="modal">
        <div class="modal-content">
          <h4>Login</h4><br />
          <form id="login-form">
            <div class="input-field">
              <input type="email" id="login-email" required />
              <label for="login-email">Email address</label>
            </div>
            <div class="input-field">
              <input type="password" id="login-password" required />
              <label for="login-password">Your password</label>
            </div>
            <button class="btn yellow darken-2 z-depth-0">Login</button>
            <p class="error pink-text center-align"></p>
          </form>
        </div>
      </div>
    
      <!-- ACCOUNT MODAL -->
      <div id="modal-account" class="modal">
        <div class="modal-content center-align">
          <h4>Account details</h4><br />
          <div class="account-details"></div>
        </div>
      </div>

      <script>
      

            function markdeshop() {
            var markedx = document.getElementById("marked");
            var homex = document.getElementById("home");
            var abutex = document.getElementById("abute");
            markedx.style.display = "none"
            homex.style.display = "none"
            abutex.style.display = "none"
            if (markedx.style.display === "none") {
              markedx.style.display = "block";
            } else {
              markedx.style.display = "none";
            }
          }
          function homeshow() {
            var homex = document.getElementById("home");
            var markedx = document.getElementById("marked");
            var abutex = document.getElementById("abute");
            markedx.style.display = "none"
            homex.style.display = "none"
            abutex.style.display = "none"
            if (homex.style.display === "none") {
              homex.style.display = "block";
            } else {
              homex.style.display = "none";
            }
          }

          function abuteshow() {
            var homex = document.getElementById("home");
            var markedx = document.getElementById("marked");
            var abutex = document.getElementById("abute");
            markedx.style.display = "none"
            homex.style.display = "none"
            homex.style.display = "none"
            if (abutex.style.display === "none") {
              abutex.style.display = "block";
            } else {
              abutex.style.display = "none";
            }
          }

          // function communityshow() {
          //   var markedx = document.getElementById("marked");
          //   if (markedx.style.display === "none") {
          //     markedx.style.display = "block";
          //   } else {
          //     markedx.style.display = "none";
          //   }
          // }
      </script>


      <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-analytics.js"></script>

      <script>
        // Initialize Firebase
        var config = {
        apiKey: "AIzaSyBVdVmQ87cP0B6pJyggdiZogTpcERUAKW0",
        authDomain: "web3-bwu.firebaseapp.com",
        databaseURL: "https://web3-bwu.firebaseio.com",
        projectId: "web3-bwu",
        storageBucket: "web3-bwu.appspot.com",
        messagingSenderId: "290381696535",
        appId: "1:290381696535:web:d3b9732292610f66bcd652",
        measurementId: "G-3XRR6G63GY"
        };
        firebase.initializeApp(config);
        
        // make auth and firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();
    
        // update firestore settings
        db.settings({ timestampsInSnapshots: true });
      </script>
      <!-- Compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      <script>
    
    // listen for auth status changes
    auth.onAuthStateChanged(user => {
      if (user) {
        user.getIdTokenResult().then(idTokenResult => {
          user.admin = idTokenResult.claims.admin;
          setupUI(user);
        });
      } else {
        setupUI();
      }
    });
    
    // signup
    const signupForm = document.querySelector('#signup-form');
    signupForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // get user info
      const email = signupForm['signup-email'].value;
      const password = signupForm['signup-password'].value;
    
      // sign up the user & add firestore data
      auth.createUserWithEmailAndPassword(email, password).then(cred => {
        return db.collection('users').doc(cred.user.uid).set({
          bio: signupForm['signup-bio'].value
        });
      }).then(() => {
        // close the signup modal & reset form
        const modal = document.querySelector('#modal-signup');
        M.Modal.getInstance(modal).close();
        signupForm.reset();
        signupForm.querySelector('.error').innerHTML = ''
      }).catch(err => {
        signupForm.querySelector('.error').innerHTML = err.message;
      });
    });
    
    // logout
    const logout = document.querySelector('#logout');
    logout.addEventListener('click', (e) => {
      e.preventDefault();
      auth.signOut();
    });
    
    // login
    const loginForm = document.querySelector('#login-form');
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // get user info
      const email = loginForm['login-email'].value;
      const password = loginForm['login-password'].value;
    
      // log the user in
      auth.signInWithEmailAndPassword(email, password).then((cred) => {
        // close the signup modal & reset form
        const modal = document.querySelector('#modal-login');
        M.Modal.getInstance(modal).close();
        loginForm.reset();
        loginForm.querySelector('.error').innerHTML = '';
      }).catch(err => {
        loginForm.querySelector('.error').innerHTML = err.message;
      });
    
    });
    
      </script>
      <script>
    
        // DOM elements
    const guideList = document.querySelector('.guides');
    const loggedOutLinks = document.querySelectorAll('.logged-out');
    const loggedInLinks = document.querySelectorAll('.logged-in');
    const accountDetails = document.querySelector('.account-details');
    const adminItems = document.querySelectorAll('.admin');
    
    const setupUI = (user) => {
      if (user) {
        if (user.admin) {
          adminItems.forEach(item => item.style.display = 'block');
        }
        // account info
        db.collection('users').doc(user.uid).get().then(doc => {
          const html = `
            <div>Logged in as ${user.email}</div>
            <div>${doc.data().bio}</div>
            <div class="pink-text">${user.admin ? 'Admin' : ''}</div>
          `;
          accountDetails.innerHTML = html;
        });
        // toggle user UI elements
        loggedInLinks.forEach(item => item.style.display = 'block');
        loggedOutLinks.forEach(item => item.style.display = 'none');
      } else {
        // clear account info
        accountDetails.innerHTML = '';
        // toggle user elements
        adminItems.forEach(item => item.style.display = 'none');
        loggedInLinks.forEach(item => item.style.display = 'none');
        loggedOutLinks.forEach(item => item.style.display = 'block');
      }
    };
    
    // setup materialize components
    document.addEventListener('DOMContentLoaded', function() {
    
      var modals = document.querySelectorAll('.modal');
      M.Modal.init(modals);
    
      var items = document.querySelectorAll('.collapsible');
      M.Collapsible.init(items);
    
    });
    
      </script>


    <!-- shop ------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

      <script>
var database = firebase.database();

 let postCollection = document.querySelector("#posts-collection");

 function createPost(title, hatrree, bilde, descript) {
  let div = document.createElement("div");
  div.setAttribute("class", "adContentFirbase");

  let h2 = document.createElement("h2");
  let img = document.createElement("img");
  let p = document.createElement("p");
  let article = document.createElement("article");
  
  h2.textContent = title;
  img.src = bilde;
  p.textContent = descript;
  article.textContent = hatrree;
  
  div.appendChild(h2);
  div.appendChild(img);
  div.appendChild(p);
  div.appendChild(article);

  postCollection.appendChild(div);
}

 function getPosts() {
  db.collection("makred").get().then(snapshot => {
      snapshot.docs.forEach(docs => {
        createPost(
          docs.data().Title,
          docs.data().Price,
          docs.data().Link,
          docs.data().descripton,
          console.log(docs.data())
        );
      });
    })
    .catch(err => {
      console.log(err);
    });
}

getPosts();

//selection prosses-------------------------------------------------------------------------------------------------------

var ImgName, ImgUrl;
var files = [];
var reader;


document.getElementById("select").onclick = function(e){

  var input = document.createElement('input');
  input.type= 'file';

  input.onchange = e => {
    files = e.target.files;
    reader = new FileReader();
    reader.onload = function(){
      document.getElementById('myimg').src = reader.result;
    }
    reader.readAsDataURL(files[0]);
  }
  input.click();
}

//upload prosess--------------------------------------------------------------------------------------------------------------

document.getElementById('upload').onclick = function(){
  var ImgName = document.getElementById('title').value;
  var desc = document.getElementById('dbox').value;
  var price = document.getElementById('pbox').value;
  var uploadTask = firebase.storage().ref('imgs/'+ImgName).put(files[0]);

  uploadTask.on('state_changed', function(snapshot){
    var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
    document.getElementById('upProgress').innerHTML = 'Upload'+progress+'%';
  
  },);

    var ImgName = document.getElementById('title').value;
    var desc = document.getElementById('dbox').value;
    var price = document.getElementById('pbox').value;
    var storageRef = firebase.storage().ref();
    let Dname = Math.floor(Math.random() * 100000);

    storageRef.child('imgs/'+ImgName).getDownloadURL().then(function(url) {
      
    ImgUrl = url;   
      
    console.log(ImgName);
    console.log(ImgUrl);
    console.log(desc);
    console.log(price);

      db.collection("makred").doc(`${Dname}`).set({
        Title: ImgName,
        Link: ImgUrl,
        descripton: desc,
        Price: price
      });
      }
);
}
      </script>
  </body>
</html>
